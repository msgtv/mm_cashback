javascript:!function(){let e=document.createElement("div"),t=document.createElement("form"),n="bc-id-w-f",o="bc-id-min-per",r="bc-id-sort",i="bc-id-max-page",a="bc-id-smt",l="megamarket.ru",d=document.createElement("style"),c=`<div id="div-${r}"><label for="${r}">Сорт-ка:</label><select id="${r}"><option value="DSC" selected>По убыв. %</option><option value="TTC">Цена-кэшбэк</option></select></div>`;function s(){window.BCFrmOp=!1}function u(){t.parentNode.removeChild(t),e.parentNode.removeChild(e),d.parentNode.removeChild(d),s()}document.addEventListener("change",(function(e){var t=e.target;if(t.id==n){var o=document.getElementById(r);if("CHK"==t.value)!o&&document.getElementById(a).insertAdjacentHTML("beforebegin",c);else if(o){var i=document.getElementById(`div-${r}`);i&&i.parentNode.removeChild(i)}}}));let m=["div.catalog-item-mobile","div.catalog-item"],f=".item-money .item-price span",y=".item-money .item-bonus span.bonus-amount",g=[".catalog-items-list"],v=[".catalog-items-list__show-more",".cnc-catalog-listing__show-more","button.catalog-listing__show-more"],h=[".catalog-items-list__out-of-stock-heading"];function C(e){return parseInt(e.replace(" ",""))}function $(){let e=[];for(let t of m)if((e=document.querySelectorAll(t)).length)break;return Array.from(e)}function w(e){e.parentNode.removeChild(e)}function x(e,t){let n;n="CHK"==t?y:'span[class*="old-price-discount"][class$="price"]';let o=e.querySelector(f).textContent,r=e.querySelector(n).textContent;return pp=C(o),bp=C(r),ps="CHK"==t?Math.round(bp/pp*100):100-Math.round(pp/bp*100),[pp,bp,ps]}function E(e,t){return parseInt(e.querySelector(y).dataset[t])}function I(e,t){var n=E(e,"percents"),o=E(t,"percents");return n>o?-1:n==o?0:n<o?1:void 0}function k(e,t){var n=E(e,"totalCost"),o=E(t,"totalCost");return n>o?1:n==o?0:n<o?-1:void 0}function S(){return new Promise((e=>setTimeout(e,3e3)))}async function q(e,t=0,n=[]){let o,r=function(){let e;for(let t of v)if(e=document.querySelector(t))break;return e}();for(t+=1;!(o=$()).length;)await S();if(function(e){e.forEach((function(e,t){w(e)}))}(o),n=n.concat(Array.from(o)),e&&t==e||e<1)return w(r),n;if(function(){for(var e of h)if(document.querySelectorAll(e).length)return!0;return!1}()){let e;return(e=document.querySelector(".catalog-listing__out-of-stock_items"))&&w(e),w(r),n}return r?(r.click(),await S(),await q(e,t,n)):n}async function H(e,t,n,o,r=0){return items=await q(t,r),data=function(e,t,n,o,r=[]){r.length||(r=$());let i=[];for(let t of r)try{[p,b,ps]=x(t,n),ps<e||i.push(t);let o=t.querySelector(y);if(o.textContent.includes("%"))continue;if("CHK"==n){o.textContent+=` [${ps}%]`;var a=p-b;o.dataset.totalCost=a,t.querySelector(f).insertAdjacentHTML("beforebegin",`<span style="color:green;">${a} ₽</span><br>`)}o.dataset.percents=ps}catch{continue}return t.innerHTML="",i.sort("TTC"==o?k:I),i.forEach(((e,n)=>t.appendChild(e))),{items:r,newItems:i}}(e,function(){let e;for(let t of g)if(e=document.querySelector(t))break;return e}(),n,o,items)}window.IntervalNum=0,function(){if(window.BCFrmOp)return;d.innerHTML=`label[for="${n}"], label[for="${o}"], label[for="${r}"], label[for="${i}"] {display: block;margin-bottom: 5px;}#${n}, #${o}, #${r}, #${i} {display: block;width: 100%;padding: 10px;margin-bottom: 10px;font-size: 16px;border: 2px solid #3498db;}#${a} {display: block;margin: 0 auto;padding: 5px 20px;font-size: 16px;cursor: pointer;border-radius: 5px;color: #ffffff;background-color: #3498db;}`,e.id="bc-id-overlay",e.style.position="fixed",e.style.top="0",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="#0009",e.style.zIndex="9998",t.style.position="fixed",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.padding="20px",t.style.background="#fff",t.style.border="1px solid; #ccc",t.style.zIndex="9999",t.style.borderRadius="3px";let c=`<label for="${n}">Что ищем?</label><select id="${n}"><option value="CHK">Кэшбэк</option><option value="DST" selected>Скидку</option></select><label for="${o}"">Мин. %:</label><input type="number" id="${o}" name="min-percent" value="" required"><label for="${i}">Страниц:</label><input type="number" id="${i}" name="max-page""><input id="${a}" type="submit" value="СТАРТ">`;window.location.hostname!=l?(t.tagName="DIV",c=`<div><h4>Перейдите на <a href="https://megamarket.ru/catalog/">${l}</a></h4></div>`):$().length?t.addEventListener("submit",(function(e){var t;e.preventDefault();let a=parseInt(document.getElementById(o).value),l=parseInt(document.getElementById(i).value),d=document.getElementById(n).value,c="CHK"==d?document.getElementById(r).value:void 0;u(),(t=a)<0&&(t=0),data=H(t,l,d,c,0),s()})):(t.tagName="DIV",c="<div><h4>Товары не обнаружены</h4></div>"),t.insertAdjacentHTML("beforeend",c),document.body.insertAdjacentElement("beforeend",e),document.body.insertAdjacentElement("beforeend",t),document.head.insertAdjacentElement("beforeend",d),window.BCFrmOp=!0,e.addEventListener("click",u,{once:!0})}()}();