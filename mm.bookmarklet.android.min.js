javascript:!function(){let e=document.createElement("div"),t=document.createElement("form");let n="CHK",o="bc-id-w-f",r="bc-id-min-per",i="bc-id-sort",a="bc-id-max-page",l="bc-id-smt",d="megamarket.ru",c=document.createElement("style"),s=`<div id="div-${i}"><label for="${i}">Сорт-ка:</label><select id="${i}"><option value="TTC" selected>Цена-кэшбэк</option><option value="DSC">По убыв. %</option></select></div>`;function u(){window.bestCashFormOpen=!1}function p(){t.parentNode.removeChild(t),e.parentNode.removeChild(e),c.parentNode.removeChild(c),u()}document.addEventListener("change",(function(e){var t=e.target;if(t.id==o){var r=document.getElementById(i);if(t.value==n)r||document.getElementById(o).insertAdjacentHTML("afterend",s);else if(r){var a=document.getElementById(`div-${i}`);a&&a.parentNode.removeChild(a)}}}));let f=["div.catalog-item-mobile","div.catalog-item"],m=".item-money .item-price span",b=[".catalog-items-list"],y=[".catalog-items-list__show-more",".cnc-catalog-listing__show-more","button.catalog-listing__show-more"],v=[".catalog-items-list__out-of-stock-heading"];function g(e){return parseInt(e.replace(" ",""))}function w(){let e=[];for(let t of f)if((e=document.querySelectorAll(t)).length)break;return Array.from(e)}function h(e){try{e.parentNode.removeChild(e)}catch{}}function x(e,t){let o;o=t==n?".item-money .item-bonus span.bonus-amount":'span[class*="old-price-discount"][class$="price"]';let r=e.querySelector(m).textContent,i=e.querySelector(o).textContent;return pp=g(r),bp=g(i),ps=t==n?Math.round(bp/pp*100):100-Math.round(pp/bp*100),[pp,bp,ps]}function C(e,t){return parseInt(e.dataset[t])}function $(e,t){try{var n=C(e,"percents"),o=C(t,"percents");if(n>o)return-1;if(n==o)return 0;if(n<o)return 1}catch{return 0}}function E(e,t){var n=C(e,"totalCost"),o=C(t,"totalCost");return n>o?1:n==o?0:n<o?-1:void 0}function L(){return new Promise((e=>setTimeout(e,3e3)))}async function B(e,t=0){let n,o=function(){let e;for(let t of y)if(e=document.querySelector(t))break;return e}();for(t+=1;!(n=w()).length;)await L();if(function(e){e.forEach((function(e,t){h(e)}))}(n),window.MyBCL=window.MyBCL.concat(Array.from(n)),!(e&&t==e||e<1)){if(function(){for(var e of v)if(document.querySelectorAll(e).length)return!0;return!1}()){let e;return(e=document.querySelector(".catalog-listing__out-of-stock_items"))&&h(e),void h(o)}return o?(o.click(),await L(),await B(e,t)):void 0}h(o)}async function M(e,t,o,r){window.MyBCL||(window.MyBCL=[],await B(t,0)),function(e,t,o,r){let i=[];for(let t of window.MyBCL)try{var[a,l,d]=x(t,o),c=t.cloneNode(!0);if(d>=e){i.push(c);var s=a-l;h(c.querySelector("div.discount-percentage")),c.dataset.totalCost=s,c.dataset.percents=d;var u=c.querySelector(m),p=`${d}%`;o==n&&(p=`${s} ₽ | `+p),u.insertAdjacentHTML("beforebegin",`<span style="color:red;">${p}</span><br>`)}}catch{continue}t.innerHTML="",i.sort("TTC"==r?E:$),i.forEach(((e,n)=>t.appendChild(e)))}(e,function(){let e;for(let t of b)if(e=document.querySelector(t))break;return e}(),o,r)}window.IntervalNum=0,function(){if(window.bestCashFormOpen)return;c.innerHTML=`label[for="${o}"], label[for="${r}"], label[for="${i}"], label[for="${a}"] {display: block;margin-bottom: 5px;font-size: 12px;color: #333;}#${o}, #${r}, #${i}, #${a} {display: block;width: 100%;padding: 10px;margin-bottom: 10px;font-size: 16px;border: 2px solid #3498db;border-radius: 5px;}#${l} {display: block;margin: 0 auto;padding: 5px 20px;font-size: 16px;text-align: center;text-decoration: none;cursor: pointer;border: 2px solid #3498db;border-radius: 5px;color: #ffffff;background-color: #3498db;}`,e.id="bc-id-overlay",e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="#0009",e.style.zIndex="9998",t.style.position="fixed",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%,-50%)",t.style.padding="20px",t.style.background="#fff",t.style.border="1px solid; #ccc",t.style.boxShadow="#fff 0px 0px 10px",t.style.zIndex="9999",t.style.borderRadius="3px";let s=`<label for="${o}">Что ищем?</label><select id="${o}"><option value="DST" selected>Скидку</option><option value="${n}">Кэшбэк</option></select><label for="${r}"">Мин. %:</label><input type="number" id="${r}" name="min-percent" value="" required">`;window.MyBCL?s+=`<p><b>${window.MyBCL.length} шт.</b></p>`:s+=`<label for="${a}">Страниц:</label><input type="number" id="${a}" name="max-page"">`,s+=`<input id="${l}" type="submit" value="СТАРТ">`,window.location.hostname!=d?(t.tagName="DIV",s=`<div><h4>Go to <a href="https://megamarket.ru/catalog/">${d}</a></h4></div>`):w().length||window.MyBCL?t.addEventListener("submit",(function(e){var t;e.preventDefault();let l,d=parseInt(document.getElementById(r).value),c=document.getElementById(o).value,s=c==n?document.getElementById(i).value:void 0;l=window.MyBCL?0:parseInt(document.getElementById(a).value),p(),(t=d)<0&&(t=0),M(t,l,c,s),u()})):(t.tagName="DIV",s="<div><h4>Товары не обнаружены</h4></div>"),t.insertAdjacentHTML("beforeend",s),document.body.insertAdjacentElement("beforeend",e),document.body.insertAdjacentElement("beforeend",t),document.head.insertAdjacentElement("beforeend",c),window.bestCashFormOpen=!0,e.addEventListener("click",p,{once:!0})}()}();