javascript:!function(){let e=document.createElement("div"),t=document.createElement("form"),o="CASHBACK",n="bc-id-what-find",l="bc-id-min-percent",r="bc-id-delay",i="bc-id-max-page",a="bc-id-submit",c="megamarket.ru",s="https://megamarket.ru/catalog/",d=document.createElement("style");function u(){window.bestCashFormOpen=!1}function f(){t.parentNode.removeChild(t),e.parentNode.removeChild(e),d.parentNode.removeChild(d),u()}let m=[".cnc-catalog-listing__items .catalog-item-mobile",".catalog-listing__items .ddl_product",".catalog-items-list .catalog-item-mobile",".catalog-items-list .ddl_product",],g=".item-money .item-bonus span.bonus-amount",$=["div.catalog-listing__items.catalog-listing__items_divider",".cnc-catalog-listing__items.cnc-catalog-listing__items_divider",".catalog-items-list"],y=[".cnc-catalog-listing__show-more","button.catalog-listing__show-more",".catalog-items-list__show-more",];function h(){let e;for(let t of y)if(e=document.querySelector(t))break;return e}function v(e){return parseInt(e.replace(" ",""))}function x(){let e=[];for(let t of m)if((e=document.querySelectorAll(t)).length)break;return Array.from(e)}function _(e){e.parentNode.removeChild(e)}function w(){let e=document.querySelector(".catalog-listing__out-of-stock_items");e&&_(e)}function k(e,t){let n;n=t==o?g:'span[class*="old-price-discount"][class$="price"]';let l=e.querySelector(".item-money .item-price span").textContent,r=e.querySelector(n).textContent;return pp=v(l),bp=v(r),ps=t==o?Math.round(bp/pp*100):100-Math.round(pp/bp*100),[pp,bp,ps]}function C(e,t){return(aPer=parseInt(e.querySelector(g).dataset.percents))>(bPer=parseInt(t.querySelector(g).dataset.percents))?-1:aPer==bPer?0:aPer<bPer?1:void 0}function E(e){return new Promise(t=>setTimeout(t,e))}async function S(e,t,o=0){let n=h();if(o+=1,console.log(`page - ${o}`),w(),t&&o==t){_(n);return}n?(n.click(),await E(e),await S(e,t,o)):console.log("no btn")}async function q(e,t,o=0,n=[]){let l=h();o+=1,console.log(`page - ${o}`),w();let r;for(;!(r=x()).length;)console.log("page loading waiting..."),await E(1e3);return(!function e(t){t.forEach(function(e,t){_(e)})}(r),n=n.concat(Array.from(r)),t&&o==t||t<1)?(_(l),n):l?(l.click(),await E(e),await q(e,t,o,n)):(console.log("no btn"),n)}async function I(e,t,n,l,r=0){return t*=1e3,items=await q(t,n,r),data=function e(t,n,l,r=[]){r.length||(r=x()),console.log("start parsing");let i=[];for(let a of r)try{[p,b,ps]=k(a,l),ps<t||i.push(a);let c=a.querySelector(g);if(c.textContent.includes("%"))continue;l==o&&(c.textContent+=` [${ps}%]`),c.dataset.percents=ps}catch{continue}return n.innerHTML="",i.sort(C),i.forEach((e,t)=>n.appendChild(e)),console.log("end parsing"),console.log(`elements - ${i.length}`),{items:r,newItems:i}}(e,function e(){let t;for(let o of $)if(t=document.querySelector(o))break;return t}(),l,items)}window.IntervalNum=0,!function m(){if(console.log(`Form is open? Answer: ${window.bestCashFormOpen}`),window.bestCashFormOpen)return;d.innerHTML=`
      label[for="${n}"], label[for="${l}"], label[for="${r}"], label[for="${i}"] {
        display: block;
        margin-bottom: 5px;
        font-size: 12px;
        color: #333;
      }

      #${n}, #${l}, #${r}, #${i} {
        display: block;
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        font-size: 16px;
        border: 2px solid #3498db;
        border-radius: 5px;
        transition: border-color 0.3s;
      }

      #${n}:focus, #${l}:focus, #${r}:focus, #${i}:focus {
        outline: none;
        border-color: #2ecc71;
      }

      #${n}:hover, #${l}:hover, #${r}:hover, #${i}:hover {
        border-color: #2ecc71;
      }

      #${a} {
        display: block;
        margin: 0 auto;
        padding: 5px 20px;
        font-size: 16px;
        text-align: center;
        text-decoration: none;
        cursor: pointer;
        border: 2px solid #3498db;
        border-radius: 5px;
        color: #ffffff;
        background-color: #3498db;
        transition: background-color 0.3s, color 0.3s, border-color 0.3s;
      }

      #${a}:hover {
        background-color: #ffffff;
        color: #3498db;
      }
    `,e.id="bc-id-overlay",e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="rgba(0, 0, 0, 0.5)",e.style.zIndex="9998",t.style.position="fixed",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.padding="20px",t.style.background="#fff",t.style.border="1px solid; #ccc",t.style.boxShadow="rgb(255 255 255) 0px 0px 10px",t.style.zIndex="9999",t.style.borderRadius="3px";let g=`<label for="${n}">
                    Что ищем?
                    </label>
                    <select name="select" id="${n}">
                      <option value="${o}" selected>Кэшбэк</option>
                      <option value="DISCOUNT">Скидку</option>
                    </select>
                    <label for="${l}"">
                    Минимальный процент:
                    </label>
                    <input type="number" id="${l}" name="min-percent" value="" required">
                    <label for="${r}"">Задержка (оптимальное - 3 сек.):</label>
                    <input type="number" id="${r}" name="delay" value="3" required">
                    <label for="${i}">Страниц:</label>
                    <input type="number" id="${i}" name="max-page"">
                    <input id="${a}" type="submit" value="СТАРТ">`;window.location.hostname!=c?(t.tagName="DIV",g=`<div><h4>Сначала перейдите на сайт Мегамаркет (<a href="${s}">${c}</a>)</h4></div>`):x().length?t.addEventListener("submit",function(e){var t,o,a,c;e.preventDefault();let s=parseInt(document.getElementById(l).value),d=parseInt(document.getElementById(r).value),m=parseInt(document.getElementById(i).value),g=document.getElementById(n).value;console.log([s,d,m]),f(),t=s,o=d,a=m,t<0&&(t=0),data=I(t,o,a,c=g,0),u()}):(t.tagName="DIV",g=`<div><h4>Сначала выберите любую категорию товаров из каталога <a style='font-weight: bold;' href="${s}">${c}</a></h4></div>`),t.insertAdjacentHTML("beforeend",g),document.body.insertAdjacentElement("beforeend",e),document.body.insertAdjacentElement("beforeend",t),document.head.insertAdjacentElement("beforeend",d),window.bestCashFormOpen=!0,e.addEventListener("click",f,{once:!0})}()}();