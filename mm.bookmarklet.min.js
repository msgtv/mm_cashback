javascript:!function(){let e=document.createElement("div"),t=document.createElement("form");window.MyBCLErrors=[];let o="DST",n="CHK",r="bc-id-w-f",l="bc-id-min-per",i="bc-id-sort",a="bc-id-max-page",c="bc-id-smt",s="megamarket.ru",d=document.createElement("style"),u=`<div id="div-${i}"><label for="${i}">Сорт-ка:</label><select id="${i}"><option value="TTC" selected>Цена-кэшбэк</option><option value="DSC">По убыв. %</option></select></div>`;function f(){window.bestCashFormOpen=!1}function p(){t.parentNode.removeChild(t),e.parentNode.removeChild(e),d.parentNode.removeChild(d),f()}document.addEventListener("change",function(e){var t=e.target;if(t.id==r){var o=document.getElementById(i);if(t.value==n)o||document.getElementById(r).insertAdjacentHTML("afterend",u);else if(o){var l=document.getElementById(`div-${i}`);l&&l.parentNode.removeChild(l)}}});let m=["div.catalog-item-mobile","div.catalog-item",],b=".item-money .item-price span",g=[".catalog-items-list",],y=[".catalog-items-list__show-more",".cnc-catalog-listing__show-more","button.catalog-listing__show-more",],v=[".catalog-items-list__out-of-stock-heading"];function $(e){return parseInt(e.replace(" ",""))}function h(){let e=[];for(let t of m)if((e=document.querySelectorAll(t)).length)break;return Array.from(e)}function C(e){try{e.parentNode.removeChild(e)}catch{console.log(`no removed ${e}`)}}function x(e,t){let o;o=t==n?".item-money .item-bonus span.bonus-amount":'span[class*="old-price-discount"][class$="price"]';let r=e.querySelector(b).textContent,l=e.querySelector(o).textContent;return pp=$(r),bp=$(l),ps=t==n?Math.round(bp/pp*100):100-Math.round(pp/bp*100),console.log([pp,bp,ps]),[pp,bp,ps]}function _(e,t){return parseInt(e.dataset[t])}function E(e,t){try{var o=_(e,"percents"),n=_(t,"percents");if(o>n)return -1;if(o==n)return 0;if(o<n)return 1}catch{console.log("ошибка при сортировке"),console.log(`a - ${e}`),console.log(`b - ${t}`),window.MyBCLErrors.push([e,t])}}function L(e,t){var o=_(e,"totalCost"),n=_(t,"totalCost");return o>n?1:o==n?0:o<n?-1:void 0}function B(){return new Promise(e=>setTimeout(e,3e3))}async function M(e,t=0){let o=function e(){let t;for(let o of y)if(t=document.querySelector(o))break;return t}();t+=1,console.log(`page - ${t}`);let n;for(;!(n=h()).length;)console.log("page loading waiting..."),await B(1e3);if(!function e(t){t.forEach(function(e,t){C(e)})}(n),window.MyBCL=window.MyBCL.concat(Array.from(n)),e&&t==e||e<1){C(o);return}if(function e(){for(var t of v)if(document.querySelectorAll(t).length)return!0;return!1}()){let r;(r=document.querySelector(".catalog-listing__out-of-stock_items"))&&C(r),C(o);return}if(o)return o.click(),await B(),await M(e,t);console.log("no btn")}async function k(e,t,o,r){window.MyBCL||(window.MyBCL=[],await M(t,0));!function e(t,o,r,l){console.log("start parsing");let i=[];for(let a of window.MyBCL)try{var[c,s,d]=x(a,r),u=a.cloneNode(!0);if(d>=t){i.push(u);var f=c-s;C(u.querySelector("div.discount-percentage")),u.dataset.totalCost=f,u.dataset.percents=d;var p=u.querySelector(b),m=`${d}%`;r==n&&(m=`${f} ₽ | `+m),p.insertAdjacentHTML("beforebegin",`<span style="color:red;">${m}</span><br>`)}}catch{continue}o.innerHTML="",i.sort("TTC"==l?L:E),i.forEach((e,t)=>o.appendChild(e)),console.log("end parsing"),console.log(`elements - ${i.length}`)}(e,function e(){let t;for(let o of g)if(t=document.querySelector(o))break;return t}(),o,r)}window.IntervalNum=0,!function u(){if(console.log(`Form is open? Answer: ${window.bestCashFormOpen}`),window.bestCashFormOpen)return;d.innerHTML=`label[for="${r}"], label[for="${l}"], label[for="${i}"], label[for="${a}"] {display: block;margin-bottom: 5px;font-size: 12px;color: #333;}#${r}, #${l}, #${i}, #${a} {display: block;width: 100%;padding: 10px;margin-bottom: 10px;font-size: 16px;border: 2px solid #3498db;border-radius: 5px;transition: border-color 0.3s;}#${r}:focus, #${l}:focus, #${i}:focus, #${a}:focus {outline: none;border-color: #2ecc71;}#${r}:hover, #${l}:hover, #${i}:hover, #${a}:hover {border-color: #2ecc71;}#${c} {display: block;margin: 0 auto;padding: 5px 20px;font-size: 16px;text-align: center;text-decoration: none;cursor: pointer;border: 2px solid #3498db;border-radius: 5px;color: #ffffff;background-color: #3498db;}`,e.id="bc-id-overlay",e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="#0009",e.style.zIndex="9998",t.style.position="fixed",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.padding="20px",t.style.background="#fff",t.style.border="1px solid; #ccc",t.style.boxShadow="rgb(255 255 255) 0px 0px 10px",t.style.zIndex="9999",t.style.borderRadius="3px";let m=`<label for="${r}">Что ищем?</label><select id="${r}"><option value="${o}" selected>Скидку</option><option value="${n}">Кэшбэк</option></select><label for="${l}"">Мин. %:</label><input type="number" id="${l}" name="min-percent" value="" required">`;window.MyBCL?m+=`<p><b>${window.MyBCL.length} шт.</b></p>`:m+=`<label for="${a}">Страниц:</label><input type="number" id="${a}" name="max-page"">`,m+=`<input id="${c}" type="submit" value="СТАРТ">`,window.location.hostname!=s?(t.tagName="DIV",m=`<div><h4>Перейдите на <a href="https://megamarket.ru/catalog/">${s}</a></h4></div>`):h().length||window.MyBCL?t.addEventListener("submit",function(e){var t,o,c,s;e.preventDefault();let d=parseInt(document.getElementById(l).value),u=document.getElementById(r).value,m=u==n?document.getElementById(i).value:void 0,b;b=window.MyBCL?0:parseInt(document.getElementById(a).value),console.log([d,b]),p(),t=d,o=b,c=u,s=m,console.log("start"),t<0&&(t=0),k(t,o,c,s),f()}):(t.tagName="DIV",m=`<div><h4>Товары не обнаружены</h4></div>`),t.insertAdjacentHTML("beforeend",m),document.body.insertAdjacentElement("beforeend",e),document.body.insertAdjacentElement("beforeend",t),document.head.insertAdjacentElement("beforeend",d),window.bestCashFormOpen=!0,e.addEventListener("click",p,{once:!0})}()}();